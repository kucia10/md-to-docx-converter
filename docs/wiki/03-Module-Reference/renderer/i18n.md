# i18n (Multi-language Support)

## Summary
- **Responsibility**: Application multi-language support (i18next setup, language management)
- **Main Users/Callers**: [`main.tsx`](../../../../../src/renderer/main.tsx), entire application
- **Key Entry Points**: [`i18n`](../../../../../src/renderer/i18n.ts:59) configuration, [`getInitialLanguage()`](../../../../../src/renderer/i18n.ts:23)

## Location in Architecture
- **Layer**: Renderer Process - Configuration Layer (Localization)
- **Upstream/Downstream Dependencies**:
  - **Dependencies**: `i18next`, `react-i18next`, `locales/` JSON files
  - **Used by**: Entire application (multi-language text rendering)
- **Role in Runtime Flow**: Initialization → Detect language → Load translation resources → Configure i18next

## Public Interface

### SUPPORTED_LANGUAGES
```typescript
const SUPPORTED_LANGUAGES = [
  'ko', 'en', 'ja', 'zh-CN', 'zh-TW',
  'es', 'fr', 'de', 'it', 'pt-BR', 'ru', 'ar'
]
```

### Exports
```typescript
export { SUPPORTED_LANGUAGES }
export default i18n
```

## Internal Behavior

### Major Flows
1. **Initial Language Detection**: [`getInitialLanguage()`](../../../../../src/renderer/i18n.ts:23)
   - Read saved language from `localStorage.getItem('language')`
   - If missing, detect system language from `navigator.language`
   - Fallback to Korean(`'ko'`) if language not supported

2. **Language Mapping**: [`langMap`](../../../../../src/renderer/i18n.ts:32)
   - Map common language codes to supported languages
   - Example: `'pt'` → `'pt-BR'`, `'zh'` → `'zh-CN'`

3. **i18next Initialization**: [`i18n.init()`](../../../../../src/renderer/i18n.ts:59)
   - `resources`: Load translation resources
   - `lng`: Set initial language
   - `fallbackLng`: Korean fallback

### Key Rules/Algorithms
- **Language Determination Priority**:
   1. Language saved in `localStorage` (if in supported list)
   2. System language exact match
   3. Mapped language
   4. Korean(`'ko'`) fallback

- **Language Code Separation**: Extract base language code with `navigator.language.split('-')[0]`
   - Example: `'en-US'` → `'en'`, `'zh-CN'` → `'zh'`

### Edge Cases
- Unsupported system language: Korean fallback
- Invalid language code in `localStorage`: Detect system language
- No refresh needed after language change: i18next auto-updates

## Data/Models

### Supported Languages List
| Language Code | Language Name | Locale File |
|---------------|----------------|-------------|
| `ko` | Korean | `ko.json` |
| `en` | English | `en.json` |
| `ja` | Japanese | `ja.json` |
| `zh-CN` | Chinese Simplified | `zh-CN.json` |
| `zh-TW` | Chinese Traditional | `zh-TW.json` |
| `es` | Spanish | `es.json` |
| `fr` | French | `fr.json` |
| `de` | German | `de.json` |
| `it` | Italian | `it.json` |
| `pt-BR` | Portuguese (Brazil) | `pt-BR.json` |
| `ru` | Russian | `ru.json` |
| `ar` | Arabic | `ar.json` |

### Language Mapping Table
| System Language | Mapped Language | Note |
|----------------|-----------------|------|
| `pt` | `pt-BR` | Portuguese default |
| `zh` | `zh-CN` | Chinese Simplified default |
| `en`, `ja`, `es`, `fr`, `de`, `it`, `ru`, `ar` | Same | Exact match |

## Configuration/Environment Variables
- `localStorage.language`: Save user language preference

## Dependencies

### Internal Modules
- [`locales/`](../../../../../src/renderer/locales/): Multi-language JSON files (12 files)

### External Libraries/Services
- i18next: Multi-language library
- react-i18next: React i18next binding
- Web API: `navigator.language`, `localStorage`

## Testing
- **Related Tests**: `vitest` unit tests (add if needed)
- **Coverage/Gaps**: Currently no tests, i18n testing needed
- **Test Scenarios**:
  - Initial language detection (no localStorage)
  - Retrieve language from localStorage
  - Unsupported system language fallback
  - Language mapping behavior
  - Render translation text

## Operations/Observability

### Logging
- None (i18next internal logging used)

### Metrics/Tracing
- None

### Alert Points
- Missing translation key: Display key itself (i18next default behavior)
- Unsupported language: Korean fallback

## i18next Configuration

### Initialization Options
```typescript
i18n
  .use(initReactI18next)
  .init({
    resources: {
      ko: { translation: ko },
      en: { translation: en },
      // ... other languages
    },
    lng: getInitialLanguage(),  // Initial language
    fallbackLng: 'ko',         // Fallback language
    interpolation: {
      escapeValue: false       // Disable XSS prevention (React handles it)
    }
  })
```

### Translation Usage
```tsx
import { useTranslation } from 'react-i18next'

function MyComponent() {
  const { t } = useTranslation()
  return <h1>{t('app.title')}</h1>
}
```

### Translation Key Structure (Example)
```json
{
  "app": {
    "title": "MD to DOCX Converter"
  },
  "common": {
    "cancel": "취소",
    "save": "저장"
  }
}
```

## Language Change

### LanguageToggle Component
```tsx
const changeLanguage = (lang: string) => {
  i18n.changeLanguage(lang)
  localStorage.setItem('language', lang)
}
```

## Related Components
- [`LanguageToggle`](../components/LanguageToggle.md): Language selection UI

## Locale File Locations
- `src/renderer/locales/ko.json`
- `src/renderer/locales/en.json`
- `src/renderer/locales/ja.json`
- `src/renderer/locales/zh-CN.json`
- `src/renderer/locales/zh-TW.json`
- `src/renderer/locales/es.json`
- `src/renderer/locales/fr.json`
- `src/renderer/locales/de.json`
- `src/renderer/locales/it.json`
- `src/renderer/locales/pt-BR.json`
- `src/renderer/locales/ru.json`
- `src/renderer/locales/ar.json`

## RTL(Right-to-Left) Language Support
- **Arabic(`ar`)** is RTL language
- Tailwind CSS requires `dir="rtl"` attribute
- Future improvement needed: Direction change when theme switches

## Future Improvements
- Enhanced automatic language detection (including region codes)
- Missing translation key detection
- Complete RTL language support
- Translation resource code splitting

## Changelog (Optional)
- v1.0: Initial implementation (12 languages supported)