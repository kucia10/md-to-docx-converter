# i18n (다국어 지원)

## 요약
- **책임**: 애플리케이션 다국어 지원 (i18next 설정, 언어 관리)
- **주요 사용자/호출자**: [`main.tsx`](../../../../../src/renderer/main.tsx), 전체 애플리케이션
- **핵심 엔트리포인트**: [`i18n`](../../../../../src/renderer/i18n.ts:59) 설정, [`getInitialLanguage()`](../../../../../src/renderer/i18n.ts:23)

## 아키텍처 내 위치
- **레이어**: Renderer Process - Configuration Layer (Localization)
- **상위/하위 의존**:
  - 의존: `i18next`, `react-i18next`, `locales/` JSON 파일
  - 사용: 전체 애플리케이션 (다국어 텍스트 렌더링)
- **런타임 플로우에서의 역할**: 초기화 → 언어 감지 → 번역 리소스 로드 → i18next 설정

## 퍼블릭 인터페이스

### SUPPORTED_LANGUAGES
```typescript
const SUPPORTED_LANGUAGES = [
  'ko', 'en', 'ja', 'zh-CN', 'zh-TW',
  'es', 'fr', 'de', 'it', 'pt-BR', 'ru', 'ar'
]
```

### 내보내기
```typescript
export { SUPPORTED_LANGUAGES }
export default i18n
```

## 내부 동작

### 주요 플로우
1. **초기 언어 감지**: [`getInitialLanguage()`](../../../../../src/renderer/i18n.ts:23)
   - `localStorage.getItem('language')`로 저장된 언어 읽기
   - 없으면 `navigator.language`에서 시스템 언어 감지
   - 지원하지 않는 언어면 한국어(`'ko'`) 폴백

2. **언어 매핑**: [`langMap`](../../../../../src/renderer/i18n.ts:32)
   - 공통 언어 코드를 지원하는 언어로 매핑
   - 예: `'pt'` → `'pt-BR'`, `'zh'` → `'zh-CN'`

3. **i18next 초기화**: [`i18n.init()`](../../../../../src/renderer/i18n.ts:59)
   - `resources`: 번역 리소스 로드
   - `lng`: 초기 언어 설정
   - `fallbackLng`: 한국어 폴백

### 핵심 규칙/알고리즘
- **언어 결정 우선순위**:
  1. `localStorage`에 저장된 언어 (지원 목록에 있는 경우)
  2. 시스템 언어 정확히 일치
  3. 매핑된 언어
  4. 한국어(`'ko'`) 폴백

- **언어 코드 분리**: `navigator.language.split('-')[0]`로 기본 언어 코드 추출
  - 예: `'en-US'` → `'en'`, `'zh-CN'` → `'zh'`

### 엣지케이스
- 지원하지 않는 시스템 언어: 한국어 폴백
- `localStorage`에 잘못된 언어 코드: 시스템 언어 감지
- 언어 변경 후 새로고침 필요: 없음 (i18next가 자동 업데이트)

## 데이터/모델

### 지원 언어 목록
| 언어 코드 | 언어 이름 | locale 파일 |
|-----------|----------|-------------|
| `ko` | 한국어 | `ko.json` |
| `en` | 영어 | `en.json` |
| `ja` | 일본어 | `ja.json` |
| `zh-CN` | 중국어 간체 | `zh-CN.json` |
| `zh-TW` | 중국어 번체 | `zh-TW.json` |
| `es` | 스페인어 | `es.json` |
| `fr` | 프랑스어 | `fr.json` |
| `de` | 독일어 | `de.json` |
| `it` | 이탈리아어 | `it.json` |
| `pt-BR` | 포르투갈어 (브라질) | `pt-BR.json` |
| `ru` | 러시아어 | `ru.json` |
| `ar` | 아랍어 | `ar.json` |

### 언어 매핑 테이블
| 시스템 언어 | 매핑 언어 | 비고 |
|------------|-----------|------|
| `pt` | `pt-BR` | 포르투갈어 기본 |
| `zh` | `zh-CN` | 중국어 간체 기본 |
| `en`, `ja`, `es`, `fr`, `de`, `it`, `ru`, `ar` | 동일 | 정확히 일치 |

## 설정/환경변수
- `localStorage.language`: 사용자 언어 선호도 저장

## 의존성

### 내부 모듈
- [`locales/`](../../../../../src/renderer/locales/): 다국어 JSON 파일 (12개)

### 외부 라이브러리/서비스
- i18next: 다국어 라이브러리
- react-i18next: React용 i18next 바인딩
- Web API: `navigator.language`, `localStorage`

## 테스트
- 관련 테스트: `vitest` 단위 테스트 (필요 시 추가)
- 커버리지/갭: 현재 테스트 없음, i18n 테스트 필요
- 테스트 시나리오:
  - 초기 언어 감지 (localStorage 없음)
  - localStorage에서 언어 복원
  - 지원하지 않는 시스템 언어 폴백
  - 언어 매핑 동작
  - 번역 텍스트 렌더링

## 운영/관찰가능성

### 로그
- 없음 (i18next 내부 로그 사용)

### 메트릭/트레이싱
- 없음

### 알람 포인트
- 번역 키 누락: 키 자체 표시 (i18next 기본 동작)
- 지원하지 않는 언어: 한국어 폴백

## i18next 설정

### 초기화 옵션
```typescript
i18n
  .use(initReactI18next)
  .init({
    resources: {
      ko: { translation: ko },
      en: { translation: en },
      // ... 기타 언어
    },
    lng: getInitialLanguage(),  // 초기 언어
    fallbackLng: 'ko',         // 폴백 언어
    interpolation: {
      escapeValue: false       // XSS 방지 비활성화 (React가 처리)
    }
  })
```

### 번역 사용
```tsx
import { useTranslation } from 'react-i18next'

function MyComponent() {
  const { t } = useTranslation()
  return <h1>{t('app.title')}</h1>
}
```

### 번역 키 구조 (예시)
```json
{
  "app": {
    "title": "MD to DOCX Converter"
  },
  "common": {
    "cancel": "취소",
    "save": "저장"
  }
}
```

## 언어 변경

### LanguageToggle 컴포넌트에서
```tsx
const changeLanguage = (lang: string) => {
  i18n.changeLanguage(lang)
  localStorage.setItem('language', lang)
}
```

## 관련 컴포넌트
- [`LanguageToggle`](../components/LanguageToggle.md): 언어 선택 UI

## 로케일 파일 위치
- `src/renderer/locales/ko.json`
- `src/renderer/locales/en.json`
- `src/renderer/locales/ja.json`
- `src/renderer/locales/zh-CN.json`
- `src/renderer/locales/zh-TW.json`
- `src/renderer/locales/es.json`
- `src/renderer/locales/fr.json`
- `src/renderer/locales/de.json`
- `src/renderer/locales/it.json`
- `src/renderer/locales/pt-BR.json`
- `src/renderer/locales/ru.json`
- `src/renderer/locales/ar.json`

## RTL(Right-to-Left) 언어 지원
- **아랍어(`ar`)**는 RTL 언어
- Tailwind CSS에서 `dir="rtl"` 속성 필요
- 향후 구현 필요: 테마 전환 시 방향 변경

## 향후 개선 가능성
- 자동 언어 감지 개선 (지역 코드 포함)
- 번역 키 누락 감지
- RTL 언어 완전 지원
- 번역 리소스 분할 (code splitting)

## 변경 이력(선택)
- v1.0: 초기 구현 (12개 언어 지원)